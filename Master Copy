#requires gWidgets
#requires gWidgetstcltk in particular as this works better on Windows
library(gWidgetstcltk)
library(bio3d)

win <- gwindow(title = "Analysing PDB structures")
group <- ggroup(horizontal = FALSE, container=win)
label <- glabel("Type your PDB code here and press Go:", container=group)
innergroup <- ggroup(container = group)
pdbfileedit <- gedit(container=innergroup)
label <- glabel("Input the chain of your PDB file you would like to assess:", container=group)
userchainname <- gedit(container=group)

button <- gbutton("Go", container=innergroup, handler=function(h,...) {
  poi<-(svalue(pdbfileedit))
  binding <-binding_site (poi, "poi.pdb")
  chainname <-(svalue(userchainname))
  
  #Giving the user the identified binding sites of their PDB file
  obj4 <- glabel("Identified binding site residues of your PDB file:",container = group)
  obj5 <- gcombobox(c(binding), container=group)
  obj5a<-glabel("Just a moment...", container=group)
  blast<-blast_limited (poi)
  rdm <-getrdm(poi)
  
    #Giving the user the 5 directed random BLAST results of their PDB file
  obj6 <- glabel("BLAST results on your PDB file with an identity of 65<x>50 compared to your protein-of-interest:", container = group)
  obj7 <- glabel(c(rdm), container=group)
  obj7a<-glabel("...and another moment, patience is a virtue...", container=group)
  label1 <- glabel("Input file names for your BLAST results which will be saved locally, then press Go:", container=group)
  innergroup0 <- ggroup(container = group)
  userfilename1 <- gedit(container=innergroup0)
  userfilename2 <- gedit(container=innergroup0)
  userfilename3 <- gedit(container=innergroup0)
  userfilename4 <- gedit(container=innergroup0)
  userfilename5 <- gedit(container=innergroup0)
  button1 <- gbutton ( "Go", container=group, handler=function(h,...){
    filename_1<-(svalue(userfilename1))
    filename_2<-(svalue(userfilename2))
    filename_3<-(svalue(userfilename3))
    filename_4<-(svalue(userfilename4))
    filename_5<-(svalue(userfilename5))
    
    write_files (blast)
    
    files<-save_files (blast, filename_1, filename_2, filename_3, filename_4, filename_5)
    bs_1 <-bindingsites_res (blast)
  
    rmsdvalues<-rmsd_matrix (chainname, blast, rdm)
    rmsdvaluesbs<-rmsdbs_matrix (blast, poi)
    poialign<-poi_align (no_chain = blast,poi)
    
    innergroup1 <- ggroup(container = group)
    #Giving the user the identified binding sites of the BLAST results of their PDB file
    obj8 <- glabel("Identified binding sites of", container = innergroup1)
    obj9<-glabel(blast[1], container=innergroup1)
    obj10 <- gcombobox(c(bs_1[[1]]$resnames), container=group)
    innergroup2 <- ggroup(container = group)
    obj11 <- glabel("Identified binding sites of", container = innergroup2)
    obj12 <-glabel(blast[2], container=innergroup2)
    obj13 <- gcombobox(c(bs_1[[2]]$resnames), container=group)
    innergroup3 <- ggroup(container = group)
    obj14 <- glabel("Identified binding sites of", container = innergroup3)
    obj15 <-glabel(blast[3], container=innergroup3)
    obj16 <- gcombobox(c(bs_1[[3]]$resnames), container=group)
    innergroup4 <- ggroup(container = group)
    obj17 <- glabel("Identified binding sites of", container = innergroup4)
    obj18 <-glabel(blast[4], container=innergroup4)
    obj19 <- gcombobox(c(bs_1[[4]]$resnames), container=group)
    innergroup5 <- ggroup(container = group)
    obj20 <- glabel("Identified binding sites of", container = innergroup5)
    obj21<- glabel(blast[5], container=innergroup5)
    obj22 <- gcombobox(c(bs_1[[5]]$resnames), container=group)
  })})



